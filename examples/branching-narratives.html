---
title: "Branching Narratives | RedBlue Developer Guide"
section: 
pageTitle: Branching Narratives
layout: default
footer: footer.html
styles: guide/styles.html
scripts: guide/scripts.html
pageScripts: guide/branching-narratives.scripts.html
---
      <!--
        Design considerations:
        • Does `playlist` make sense to mark up annotations *within* a video,
          or is it only for “meta-videos”, i.e. those that embed other videos?
        • `playlist type="nonlinear"` is only required if sibling actions
          (`goto`, `playlistAction`, `media`) are not guranteed to execute.
        • `playlist type="linear"` means that all actions are guaranteed to
          execute provided the user encounters their triggers (typically duration)
        • If a video only has one action, is `playlist` required?
      -->
      <h2>Self-hosted</h2>
      <nav id="tab-links" class="tab-links">
        <a id="guide_branching-narratives_self-hosted_xml" class="tab-link" href="#xml">XML</a> | <a id="guide_branching-narratives_self-hosted_json" class="tab-link" href="#json-ld">JSON-LD</a>
      </nav>
      <article id="xml" class="tab">
        <h3>XML</h3>
        <section id="xml-code">
          <h4>Code</h4>
          <pre><code id="code-xml" class="xml full-example"></code></pre>
        </section>
        <section id="xml-result">
          <h4>Result</h4>
          <redblue-video id="redblue-branching-xml" aspect-ratio="16:9">
            <hvml
              xmlns="https://hypervideo.tech/hvml#"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              xmlns:css="https://www.w3.org/TR/CSS/"
              xml:lang="en-US"
              hidden="hidden"
            >
              <video xml:lang="en" xml:id="branching-narrative">
                <title>RedBlue Test</title>
                <published>2014</published>
                <runtime>variable</runtime>
                <description>Branching narratives demo</description>
                <presentation>
                  <file xml:id="intro-webm-1080p" label="intro" xlink:href="media/webm/intro-1080p.webm">
                    <container>
                      <mime>video/webm</mime>
                      <codec type="video">
                        <mime>vp8</mime>
                      </codec>
                      <codec type="audio">
                        <mime>vorbis</mime>
                      </codec>
                    </container>
                  </file>
                  <file xml:id="red-pill-outcome-webm-1080p" label="red" xlink:href="media/webm/red-pill-outcome-1080p.webm">
                    <container>
                      <mime>video/webm</mime>
                      <codec type="video">
                        <mime>vp8</mime>
                      </codec>
                      <codec type="audio">
                        <mime>vorbis</mime>
                      </codec>
                    </container>
                  </file>
                  <file xml:id="blue-pill-outcome-webm-1080p" label="blue" xlink:href="media/webm/blue-pill-outcome-1080p.webm">
                    <container>
                      <mime>video/webm</mime>
                      <codec type="video">
                        <mime>vp8</mime>
                      </codec>
                      <codec type="audio">
                        <mime>vorbis</mime>
                      </codec>
                    </container>
                  </file>
                  <file xml:id="choice-1-wait-screen-1080p" label="choice-1-wait-screen" xlink:href="media/bitmap/choice-1-wait-screen.jpg">
                    <codec>
                      <name>JPEG</name>
                      <mime>image/jpeg</mime>
                    </codec>
                  </file>
                  <file xml:id="the-end-wait-screen-1080p" label="the-end-wait-screen" xlink:href="media/bitmap/the-end-wait-screen.png">
                    <codec>
                      <name>PNG</name>
                      <mime>image/png</mime>
                    </codec>
                  </file>
                  <playlist type="nonlinear">
                    <media xml:id="intro" xlink:href="#xpointer(//file[@label='intro'])">
                      <goto on="durationEnd" xlink:href="#red-pill-or-blue-pill"></goto>
                    </media>
                    <choices xml:id="red-pill-or-blue-pill"><!--displayType="generate|embedded"-->
                      <name>What will it be, Neo?</name>
                      <media xlink:href="#xpointer(//file[@label='choice-1-wait-screen'])"></media>
                      <choice xml:id="red">
                        <name>Red Pill</name>
                        <goto
                          xlink:actuate="onRequest"
                          xlink:href="#wakes-up-to-reality"
                          width="28%"
                          height="45%"
                          css:top="26%"
                          css:left="17%"
                        ></goto>
                      </choice>
                      <choice xml:id="blue">
                        <name>Blue Pill</name>
                        <playlistAction xlink:actuate="onRequest"></playlistAction>
                        <playlistAction xlink:actuate="onRequest" method="doSomethingElse"></playlistAction>
                        <goto
                          xlink:actuate="onRequest"
                          xlink:href="#stays-in-the-matrix"
                          width="31%"
                          height="39%"
                          css:top="34%"
                          css:left="52%"
                        ></goto>
                      </choice>
                    </choices>
                    <media xml:id="wakes-up-to-reality" xlink:href="#xpointer(//file[@label='red'])">
                      <goto xlink:href="#what-next"></goto>
                    </media>
                    <media xml:id="stays-in-the-matrix" xlink:href="#xpointer(//file[@label='blue'])">
                      <goto xlink:href="#what-next"></goto>
                    </media>
                    <choices xml:id="what-next">
                      <name>What next?</name>
                      <media xlink:href="#xpointer(//file[@label='the-end-wait-screen'])"></media>
                      <choice xml:id="start-over">
                        <name>Start Over</name>
                        <goto
                          xlink:actuate="onRequest"
                          xlink:href="#intro"
                          timeline="replace"
                          width="100%"
                          css:top="80%"
                          css:left="0"
                          css:font-size="4vw"
                          css:text-align="center"
                          css:color="white"
                        ></goto><!-- timeline = replace | restart? could be a do over that does not replace the entire timeline, like an undo | continue [default] -->
                      </choice>
                      <!-- <choice>
                        <name>Watch My Movie</name>
                        <goto
                          xlink:actuate="onRequest"
                          timeline="replay"
                          width="49%"
                          css:top="80%"
                          css:right="0"
                          css:font-size="4vw"
                          css:text-align="center"
                          css:color="white"
                        ></goto>
                      </choice> -->
                    </choices>
                    <media xml:id="easter-egg" xlink:href="#xpointer(//file[@label='easter-egg'])"></media>
                  </playlist>
                </presentation>
              </video>
            </hvml>
          </redblue-video>
        </section>
      </article>
      <article id="json-ld" class="tab">
        <h3>JSON-LD</h3>
        <section id="json-ld-code">
          <h4>Code</h4>
          <pre><code id="code-json-ld" class="xml full-example"></code></pre>
        </section>
        <section id="json-ld-result">
          <h4>Result</h4>
          <!-- <redblue-video id="redblue-youtube-json-ld" aspect-ratio="16:9">
            <script type="application/ld+json"></script>
          </redblue-video> -->
        </section>
      </article>
      <article id="detailed-instructions">
        <h2>Detailed Instructions</h2>
        <p>For this example, we’re creating a movie that presents the viewer with a choice. Depending on the viewer’s choice, the movie shows one of two alternate endings.</p>
        <p>To achieve this, we have three video segments: the Introduction, Choice 1’s “Red Pill” Outcome, and Choice 1’s “Blue Pill” Outcome.</p>
        <p>We also have two images: the Choice 1 Wait Screen and the Ending Wait Screen.</p>
        <p>Put together, the playback sequence looks like this: Intro → Choice 1 Wait Screen → ( “Red Pill” Outcome OR “Blue Pill” Outcome ) → Ending Wait Screen.</p>
        <p>With RedBlue, you don’t have to write the logic to achieve this playback sequence yourself. You simply use declarative <abbr>HVML</abbr> markup to specify what the available choices are and which files to play for each choice. The player code handles the rest.</p>
        <section id="attaching-a-third-party-embed">
          <h3>Setup</h3>
          <dl class="instructions">
            <dd class="step">Import the RedBlue video player Custom Element. (This requires ES6 support to work directly in the browser; otherwise the source code can be transpiled to ES5.)</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;script type="module"&gt;
  import RedBlueVideo from './modules/redblue-video-compat.js';
  customElements.define( RedBlueVideo.is, RedBlueVideo );
&lt;/script&gt;</code></pre></dd>
            <dd class="step">Include an <a id="guide_third-party-embeds_attaching-a-third-party-embed_hvml" href="https://hypervideo.tech"><abbr>HVML</abbr></a> code block as a child of <code>&lt;redblue-video&gt;</code>. <abbr>HVML</abbr> can be represented as either <abbr>XML</abbr> or <abbr>JSON-LD</abbr>. When using the <abbr>XML</abbr> serialization, set the boolean <code>hidden</code> attribute to true to prevent the browser from rendering the metadata.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;&lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
            <dd class="step">In the <abbr>HVML</abbr>, specify a single <code>video</code> element. (Not to be confused with <abbr>HTML</abbr>’s <code>video</code> element—though unless your page is served as <abbr title="application/xhtml+xml">XHTML</abbr>, technically the browser will interpret it as such.) This is the container for all of your video’s metadata.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;
    <ins>&lt;video&gt;&lt;/video&gt;</ins>
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
            <dd class="step">Under <code>video</code>, set basic metadata.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;&lt;/hvml&gt;
    &lt;video&gt;
      <ins>&lt;title&gt;RedBlue Test&lt;/title&gt;
      &lt;published&gt;2014&lt;/published&gt;
      &lt;runtime&gt;variable&lt;/runtime&gt;
      &lt;description&gt;Branching narratives demo&lt;/description&gt;</ins>
    &lt;/video&gt;
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
          </dl>
        </section>
        <section>
          <h3>Media Files</h3>
          <dl class="instructions">
            <dd class="step">Under <code>video</code>, include a <code>presentation</code> element. This is the container for instructions telling the <abbr>HVML</abbr> parser how to present a video on playback.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;
    &lt;video&gt;
      &lt;title&gt;RedBlue Test&lt;/title&gt;
      &lt;published&gt;2014&lt;/published&gt;
      &lt;runtime&gt;variable&lt;/runtime&gt;
      &lt;description&gt;Branching narratives demo&lt;/description&gt;
      <ins>&lt;presentation&gt;&lt;/presentation&gt;</ins>
    &lt;/video&gt;
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
            <dd class="step">For each media file, in any order, do this:</dd>
            <dd>Define a <code>file</code> element.</dd>
            <dd>Set its <code>label</code> attribute to an identifier that is unique amongst different media segments, but is shared between different versions of the same media segment. For instance, for the Introduction, you might have a WebM and an MP4 version; each of which might have a 1080p and a 720p version. So all four of these <code>file</code> elements could have <samp><code>label="intro"</code></samp>, which allows the RedBlue player to select the best version for playback depending on the viewer’s browser capabilities and connection speed.</dd>
            <dd>Set its <code>xlink:href</code> attribute to the <abbr>URL</abbr> of the media file.</dd>
            <dd>Optional: Set its <code>xml:id</code> attribute to a globally unique identifier, e.g. <samp><code>intro-webm-1080p</code></samp>, so it can individually referenced.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;
    &lt;video&gt;
      &lt;title&gt;RedBlue Test&lt;/title&gt;
      &lt;published&gt;2014&lt;/published&gt;
      &lt;runtime&gt;variable&lt;/runtime&gt;
      &lt;description&gt;Branching narratives demo&lt;/description&gt;
      &lt;presentation&gt;
        <ins>&lt;file label="intro" xlink:href="media/webm/intro-1080p.webm"&gt;
        &lt;file&gt;
        &lt;file label="choice-1-wait-screen" xlink:href="media/bitmap/choice-1-wait-screen.jpg"&gt;&lt;file&gt;
        &lt;file label="red-pill-outcome" xlink:href="media/webm/red-pill-outcome-1080p.webm"&gt;&lt;file&gt;
        &lt;file label="blue-pill-outcome" xlink:href="media/webm/blue-pill-outcome-1080p.webm"&gt;&lt;file&gt;
        &lt;file label="the-end-wait-screen" xlink:href="media/bitmap/the-end-wait-screen.png"&gt;&lt;file&gt;</ins>
      &lt;/presentation&gt;
    &lt;/video&gt;
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
            <dd>If a video file, specify its container, video, and audio <abbr>MIME</abbr> type identifiers. If an image file, specify a bare <code>codec</code> element.</dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;
    &lt;video&gt;
      &lt;title&gt;RedBlue Test&lt;/title&gt;
      &lt;published&gt;2014&lt;/published&gt;
      &lt;runtime&gt;variable&lt;/runtime&gt;
      &lt;description&gt;Branching narratives demo&lt;/description&gt;
      &lt;presentation&gt;
        &lt;file label="intro" xlink:href="media/webm/intro-1080p.webm"&gt;
          &lt;!-- video/webm; codecs=vp8,vorbis -->
          <ins>&lt;container&gt;
            &lt;mime&gt;video/webm&lt;/mime&gt;
            &lt;codec type="video"&gt;
              &lt;mime&gt;vp8&lt;/mime&gt;
            &lt;/codec&gt;
            &lt;codec type="audio"&gt;
              &lt;mime&gt;vorbis&lt;/mime&gt;
            &lt;/codec&gt;
          &lt;/container&gt;</ins>
        &lt;file&gt;
        &lt;file label="choice-1-wait-screen" xlink:href="media/bitmap/choice-1-wait-screen.jpg"&gt;
          <ins>&lt;codec&gt;
            &lt;mime&gt;image/jpeg&lt;/mime&gt;
          &lt;/codec&gt;</ins>
        &lt;file&gt;
        &lt;file label="red-pill-outcome" xlink:href="media/webm/red-pill-outcome-1080p.webm"&gt;
          &lt;!-- … --&gt;
        &lt;file&gt;
        &lt;file label="blue-pill-outcome" xlink:href="media/webm/blue-pill-outcome-1080p.webm"&gt;
          &lt;!-- … --&gt;
        &lt;file&gt;
        &lt;file label="the-end-wait-screen" xlink:href="media/bitmap/the-end-wait-screen.png"&gt;
          &lt;!-- … --&gt;
        &lt;file&gt;
      &lt;/presentation&gt;
    &lt;/video&gt;
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
          </dl>
        </section>
        <section>
          <h3>Nonlinear Playlists</h3>
          <p>In <abbr>HVML</abbr>, branching narratives are achieved by what is termed a <dfn>nonlinear playlist</dfn>. Nonlinear playlists are like regular playlists in that they specify a list of media files to be played back sequentially. But in nonlinear playlists, choice prompts can be queued in addition to media files. When the viewer chooses an option in a choice prompt, the play head can continue sequentially, or it can be sent to a different part of the playlist, skipping over other items.</p>
          <dl class="instructions">
            <dd class="step"></dd>
            <dd class="step step--code"><pre><code class="xml">&lt;redblue-video&gt;
  &lt;hvml xmlns="https://hypervideo.tech/hvml#" hidden="hidden"&gt;
    &lt;video&gt;
      &lt;title&gt;RedBlue Test&lt;/title&gt;
      &lt;published&gt;2014&lt;/published&gt;
      &lt;runtime&gt;variable&lt;/runtime&gt;
      &lt;description&gt;Branching narratives demo&lt;/description&gt;
      &lt;presentation&gt;
        &lt;!-- &lt;file&gt;s --&gt;
        <ins>&lt;playlist type="nonlinear"&gt;&lt;/playlist&gt;</ins>
      &lt;/presentation&gt;
    &lt;/video&gt;
  &lt;/hvml&gt;
&lt;/redblue-video&gt;</code></pre></dd>
          </dl>
        </section>
      </article>